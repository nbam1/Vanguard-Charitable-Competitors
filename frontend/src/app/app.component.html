<div class="container">
  <header>
    <img
      ngSrc="assets/logo-nimbl.png"
      width="140"
      height="46"
      alt="Nimbl Digital Logo"
      class="logo"
    />
    <h1>Competitor Analyzer</h1>
    <p class="subtitle accent">Empowering research for Vanguard Charitable</p>
  </header>

  <form [formGroup]="form" class="analysis-form" (ngSubmit)="onAnalyze()">
    <mat-form-field appearance="outline">
      <mat-label>Company Name</mat-label>
      <input matInput formControlName="company_name" required autocomplete="off" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Company Description</mat-label>
      <textarea
        matInput
        formControlName="company_description"
        rows="3"
        required
      ></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label># of competitors</mat-label>
      <input
        matInput
        type="number"
        formControlName="top_k"
        min="1"
        max="50"
        step="1"
        placeholder="10"
      />
      <mat-hint>1â€“50 (defaults to 10)</mat-hint>
    </mat-form-field>

    <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid || loading()">
      {{ loading() ? 'Analyzing...' : 'Analyze Competitors' }}
    </button>
  </form>

  @if (report()) {
    <section>
      <h2>Competitor Analysis</h2>
      <pre class="analysis-report">{{ report() }}</pre>
    </section>
  }

  @if (matches().length) {
    <section>
      <h3>Top Matches ({{ matches().length }})</h3>
      <div class="card-grid">
        @for (match of matches(); track match.id) {
          <mat-card class="competitor-card">
            <mat-card-header>
              <mat-card-title class="company-name">{{ match.name }}</mat-card-title>
              <mat-card-subtitle class="score">
                Score: {{ match.score | number: '1.2-2' }}
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <p class="description">{{ match.description }}</p>
            </mat-card-content>
          </mat-card>
        }
      </div>
    </section>
  }
</div>
